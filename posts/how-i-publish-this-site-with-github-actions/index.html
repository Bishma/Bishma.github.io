<!doctype html><html lang=en data-theme><head><title>Derek Rose | How I Publish This Site</title><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="My various home automation, electronics, coding, and/or 3D printing projects."><link rel=stylesheet href=https://dereksrose.com/css/style.min.ba7a3f0492be7bc600cde5af7e7c751c9c4ebc0080a6a97e665561a516214af1.css integrity="sha256-uno/BJK+e8YAzeWvfnx1HJxOvACApql+ZlVhpRYhSvE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/markupHighlight.min.2e1144559b08253695c4514f0dba9018f55d072434823cc46af01af358e0c5ad.css integrity="sha256-LhFEVZsIJTaVxFFPDbqQGPVdByQ0gjzEavAa81jgxa0=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/mastodonComments.min.a60d921e942ee47b663e842ca76811dbea4c339cb427650dcfa5ec6f403bf1d9.css integrity="sha256-pg2SHpQu5HtmPoQsp2gR2+pMM5y0J2UNz6Xsb0A78dk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/flex.0a98e97a73f7ce3d056c1da4ac3dfafbb5e1640858c71b5ee31543d9e075edc0.css integrity="sha256-CpjpenP3zj0FbB2krD36+7XhZAhYxxte4xVD2eB17cA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/lightbox.755b9081fac4c7d97cce7b030e7d2abeb1709a4378526f091b5449fa75076c87.css integrity="sha256-dVuQgfrEx9l8znsDDn0qvrFwmkN4Um8JG1RJ+nUHbIc=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/figure.615059e170e578e014add3ab4f7401ca633f03ec09e4aff1650eda7444793f2c.css integrity="sha256-YVBZ4XDleOAUrdOrT3QBymM/A+wJ5K/xZQ7adER5Pyw=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=https://dereksrose.com/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=https://dereksrose.com/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://dereksrose.com/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://dereksrose.com/favicons/favicon-16x16.png><link rel=canonical href=https://dereksrose.com/posts/how-i-publish-this-site-with-github-actions/><script type=text/javascript src=https://dereksrose.com/js/anatole-header.min.a3fa728a9f57833a31dfb45c48caaf1e4890c8c97f07bd7133fc2359745edb5d.js integrity="sha256-o/pyip9Xgzox37RcSMqvHkiQyMl/B71xM/wjWXRe210=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="How I Publish This Site"><meta name=twitter:description content="Building and Deploying a Hugo Site to Github Pages"><meta property="og:title" content="How I Publish This Site"><meta property="og:description" content="Building and Deploying a Hugo Site to Github Pages"><meta property="og:type" content="article"><meta property="og:url" content="https://dereksrose.com/posts/how-i-publish-this-site-with-github-actions/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-23T20:30:55-08:00"><meta property="article:modified_time" content="2023-11-18T14:33:48-08:00"><meta property="og:site_name" content="Over-Engineering Is Fun"></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=https://dereksrose.com/profile.png alt="profile picture"><h3 title><a href=/>Over-Engineering Is Fun</a></h3><div class=description><p>My various home automation, electronics, coding, and/or 3D printing projects.</p></div></div></div><ul class=social-links><li><a href=https://github.com/Bishma/ rel=me aria-label=Github><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=https://mas.to/@bishma rel=me aria-label=Mastodon><i class="fab fa-mastodon fa-2x" aria-hidden=true></i></a></li><li><a href=https://www.linkedin.com/in/dereksrose/ rel=me aria-label=LinkedIn><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Derek Rose 2023</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts/ title>Posts</a></li><li><a href=/tags/ title>Tags</a></li><li><a href=/about/ title>About</a></li><li class=theme-switch-item><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."><div class=post-content><div class=post-title><h1>How I Publish This Site</h1><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Feb 23, 2023</span>
<em class="fas fa-stopwatch"></em>
<span class=reading-time>4-minute read</span></div></div><h2 id=hahahugoshortcodes0hbhb>Building and Deploying a Hugo Site to Github Pages</h2><p><a href=https://gohugo.io/ target=_blank>Hugo</a> is a static site generator akin to
<a href=https://jekyllrb.com/ target=_blank>Jekyll</a> but built on
<a href=https://go.dev/ target=_blank>Go</a>. Pages (or in my case, blog posts) are written in Markdown, which is second nature to me. And all the page partials are written using Go Templates, which are straight forward and easy to work with.</p><p>I store the site&rsquo;s source in one
<a href=https://github.com/Bishma/blog target=_blank>public repo</a>, and then host it from
<a href=https://github.com/Bishma/Bishma.github.io target=_blank>another</a> (using
<a href=https://pages.github.com/ target=_blank>Github Pages</a>). And to do that automatically I use
<a href=https://github.com/features/actions target=_blank>Github Actions</a>. All these things were familiar topics, but didn&rsquo;t have firsthand experience with any of the specific technologies. So get to learn 4 things in one go! (Go, Hugo, Github Pages, and Github Actions)</p><p>It&rsquo;d be the dream hobby project if I only had the need for another website. So&mldr; I guess a blog it is. I took on this project in 2018 and, seeing as this is my 16th post, so you can tell how naturally I take to blogging.</p><h3 id=hosting-on-github-pages>Hosting on Github Pages</h3><p>I have lots of existing ways to host a site but this whole project was about exploring something new which lead me to look at what was trendy. In 2018
<a href=https://pages.github.com/ target=_blank>Github Pages</a> was still fairly new and free is a good price for hosting. Plus this is a personal project so F-U diligence, let&rsquo;s make a rash decision!</p><h3 id=github-actions>Github Actions</h3><p>But Hugo sites need to be
<a href=https://gohugo.io/getting-started/usage/#build-your-site target=_blank>built</a>, uploading files is tedious, and I am a very lazy person. See also, my post history. Enter
<a href=https://github.com/features/actions target=_blank>Github Actions</a> to make all this happen for me.</p><p>Actions can be attached to any repo, so I added the following to my
<a href=https://github.com/Bishma/blog target=_blank>source repo</a>. I found a
<a href=https://github.com/marketplace/actions/hugo-to-gh-pages target=_blank>ready made action (by charbad360)</a> for this, so I get to learn and be lazy. This really is the perfect project!</p><p>Looking at the repo for that action, it does all what I would do only I didn&rsquo;t have to do it and there&rsquo;s a lot of support for things I might want to utilize later. TL;DR: The
<a href=https://docs.docker.com/engine/reference/builder/ target=_blank>dockerfile</a> copies and executes a shell script on an
<a href=https://ubuntu.com/ target=_blank>Ubuntu</a> container. Said
<a href=https://github.com/chabad360/hugo-gh-pages/blob/master/docker-entrypoint.sh target=_blank>shell script</a> installs Hugo, builds the site, and commits it to my pages repo.</p><h4 id=setting-up-the-action>Setting up the action</h4><p>The first part of the Github Action sets up a listener on the main branch of my source repo (the one that this action is set up on).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Publish to Github Pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Controls when the action will run. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>main ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Allows you to run this workflow manually from the Actions tab</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><h4 id=launch-a-single-job>Launch a single job</h4><p>From there we need a single job with 2 steps (3 if you count outputting a done message). This is where I define that the job will run on Ubuntu (latest) and what steps will be run.</p><p>In the second of those steps the build process kicks off via the <code>hugo-gh-pages</code> action. It takes some parameters which are set under the <code>with:</code> key. You can see all the parameters on the
<a href=https://github.com/marketplace/actions/hugo-to-gh-pages target=_blank>marketplace page</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build-deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout Repo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Publish Site</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>chabad360/hugo-gh-pages@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>githubToken</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.PAT }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>Bishma/Bishma.github.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>args</span><span class=p>:</span><span class=w> </span>--<span class=l>gc --minify</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo Site Published</span><span class=w>
</span></span></span></code></pre></div><h4 id=personal-access-token>Personal Access Token</h4><p>This is where I have to fess up. The reason I&rsquo;m finally publishing this blog entry, 4+ years after starting the it, is that I keep forgetting this step. This whole post is documentation for me to refer to every year when my [Github Personal Access Token] expires.</p><p><img src=/images/how-i-publish-this-site-with-github-actions/settings.png align=left hspace=2> The <code>githubToken</code> key above is assigned a variable stored in the repo&rsquo;s settings under Actions. In there I created a variable named PAT (short for Personal Access Token). This is a fine-grained access token set in my account&rsquo;s settings. From setting go to <code>&lt;> Developer settings</code> (down at the bottom). Then <code>Personal Access Tokens</code>, then <code>Fine-grained Tokens</code>.</p><p>I generate a token that can only access my <code>Bishma/Bishma/github.io</code> Pages repo and I give it a single permission. Under &lsquo;Repository Permissions&rsquo; I grant Read and Write to the &lsquo;Actions&rsquo; permission. This will allow my action to push the freshly built pages into the repo. And I give it the maximum lifetime, which is currently 1 year. This is why I&rsquo;ll need to reread this blog post about once a year. I suspect I&rsquo;ll find a decreasing number of typos every anniversary for at least 4 years.</p><p>I generate the token and then paste it into the PAT variable I made back under blog settings.</p><p>That&rsquo;s it, things are getting publish now every time I do a push back to the main branch.</p><h4 id=domain>Domain</h4><p>The only thing left is adding a personal domain. I have a DNS through
<a href=https://www.dreamhost.com/ target=_blank>Dreamhost</a> so I just needed to follow
<a href=https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site target=_blank>github instructions</a> on setting up a custom domain and I was in business.</p><p>And that&rsquo;s how you set up a blog. Certainly the easiest approach to blogging anyone can imagine.</p><div class=article-content><h2>Comments</h2><p>You can use your Mastodon account to reply to this <a class=link href=https://mas.to/@bishma/109917910205854376 target=_blank>post</a>.<br>Or <a href=# id=copyButton>copy</a> and paste the post URL into the search field of the Mastodon client of your choice.</p><p id=mastodon-comments-list></p><noscript><p>You need JavaScript to view the comments.</p></noscript><script type=text/javascript src=https://dereksrose.com/js/purify.min.b09fc1236623fcc137f6a0e631ab67567ffeea4cf6d17ab50819265b0a91880e.js></script>
<script type=text/javascript>let limitBottom=document.documentElement.offsetHeight-window.innerHeight-100,commentsLoaded=!1;window.addEventListener("scroll",function(){document.documentElement.scrollTop>=limitBottom&&!commentsLoaded&&"109917910205854376"!=""?(loadComments(),commentsLoaded=!0):"109917910205854376"==""&&(document.getElementById("mastodon-comments-list").innerHTML="<em>Comments are disabled for this post.</em>")}),document.getElementById("copyButton").addEventListener("click",e=>{navigator.clipboard.writeText("https://mas.to/@bishma/109917910205854376"),e.preventDefault();const t=$("#copyButton"),n=t.text();console.log(n),t.text("👍"),setTimeout(function(){t.text(n)},2e3)});function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function loadComments(){fetch("https://mas.to/api/v1/statuses/109917910205854376/context").then(function(e){return e.json()}).then(function(e){e.descendants&&Array.isArray(e.descendants)&&e.descendants.length>0?(document.getElementById("mastodon-comments-list").innerHTML="",e.descendants.forEach(function(e){e.account.display_name=escapeHtml(e.account.display_name),e.account.emojis.forEach(t=>{e.account.display_name=e.account.display_name.replace(`:${t.shortcode}:`,`<img src="${escapeHtml(t.static_url)}" alt="Emoji ${t.shortcode}" height="20" width="20" />`)}),mastodonComment=`<div class="mastodon-comment">
                     <div class="avatar">
                       <img src="${escapeHtml(e.account.avatar_static)}" height=60 width=60 alt="">
                     </div>
                     <div class="content">
                       <div class="author">
                         <a href="${e.account.url}" rel="nofollow">
                           <span class="displayName">${e.account.display_name}</span>
                           <span class="accountName">${escapeHtml(e.account.acct)}</span>
                         </a>
                         <a class="date" href="${e.uri}" rel="nofollow">
                           ${e.created_at.substr(0,10)}
                         </a>
                       </div>
                       <div class="mastodon-comment-content">${e.content}</div> 
                     </div>
                   </div>`,document.getElementById("mastodon-comments-list").appendChild(DOMPurify.sanitize(mastodonComment,{RETURN_DOM_FRAGMENT:!0}))})):document.getElementById("mastodon-comments-list").innerHTML="<p>No comments yet.</p>"})}</script></div></div><br><div class=post-footer><div class=more-title>Find More:</div><div class=info><span class=separator><a class=tag href=/tags/automation/>automation</a><a class=tag href=/tags/development/>development</a><a class=tag href=/tags/meta/>meta</a><a class=tag href=/tags/hugo/>hugo</a></span></div><span class=separator>&nbsp; &nbsp;</span>
<span class=separator><a class=link-reverse href="https://dereksrose.com/posts/fidget-switch-missile-command-edition/?ref=footer">« Fidget Switch Missile Command Edition</a></span>
<span class=separator>&nbsp; | &nbsp;</span>
<span class=separator><a class=link-reverse href="https://dereksrose.com/posts/repbox-standoffs/?ref=footer">Repbox Standoffs »</a></span></div></div></div></div></div><script type=text/javascript src=https://dereksrose.com/js/jquery.min.decb4e8fdab5cb7b76ec6470b6fb73d30c7ee8e248d7486f49007f3c525b7acb.js integrity="sha256-3stOj9q1y3t27GRwtvtz0wx+6OJI10hvSQB/PFJbess=" crossorigin=anonymous></script>
<script type=text/javascript src=https://dereksrose.com/js/bundle.min.3ebad6bf39b2e7c2f899d3ed9bc97e8c0c1ead7a1b57472e3387321f673b8077.js integrity="sha256-PrrWvzmy58L4mdPtm8l+jAwerXobV0cuM4cyH2c7gHc=" crossorigin=anonymous></script>
<script type=text/javascript src=https://dereksrose.com/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-153109937-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script type=text/javascript src=https://dereksrose.com/js/lightbox.min.76de40f9671361fabb5e45e99a176e1740b7cf06557da3b0ce60372bcc92962b.js integrity="sha256-dt5A+WcTYfq7XkXpmhduF0C3zwZVfaOwzmA3K8ySlis=" crossorigin=anonymous></script></body></html>