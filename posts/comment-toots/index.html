<!doctype html><html lang=en data-theme><head><title>Derek Rose | Comment Toots</title><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="My various home automation, electronics, coding, and/or 3D printing projects."><link rel=stylesheet href=https://dereksrose.com/css/style.min.ba7a3f0492be7bc600cde5af7e7c751c9c4ebc0080a6a97e665561a516214af1.css integrity="sha256-uno/BJK+e8YAzeWvfnx1HJxOvACApql+ZlVhpRYhSvE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/markupHighlight.min.2e1144559b08253695c4514f0dba9018f55d072434823cc46af01af358e0c5ad.css integrity="sha256-LhFEVZsIJTaVxFFPDbqQGPVdByQ0gjzEavAa81jgxa0=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/mastodonComments.min.a60d921e942ee47b663e842ca76811dbea4c339cb427650dcfa5ec6f403bf1d9.css integrity="sha256-pg2SHpQu5HtmPoQsp2gR2+pMM5y0J2UNz6Xsb0A78dk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/flex.0a98e97a73f7ce3d056c1da4ac3dfafbb5e1640858c71b5ee31543d9e075edc0.css integrity="sha256-CpjpenP3zj0FbB2krD36+7XhZAhYxxte4xVD2eB17cA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/lightbox.755b9081fac4c7d97cce7b030e7d2abeb1709a4378526f091b5449fa75076c87.css integrity="sha256-dVuQgfrEx9l8znsDDn0qvrFwmkN4Um8JG1RJ+nUHbIc=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://dereksrose.com/css/figure.615059e170e578e014add3ab4f7401ca633f03ec09e4aff1650eda7444793f2c.css integrity="sha256-YVBZ4XDleOAUrdOrT3QBymM/A+wJ5K/xZQ7adER5Pyw=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=https://dereksrose.com/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=https://dereksrose.com/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://dereksrose.com/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://dereksrose.com/favicons/favicon-16x16.png><link rel=canonical href=https://dereksrose.com/posts/comment-toots/><script type=text/javascript src=https://dereksrose.com/js/anatole-header.min.a3fa728a9f57833a31dfb45c48caaf1e4890c8c97f07bd7133fc2359745edb5d.js integrity="sha256-o/pyip9Xgzox37RcSMqvHkiQyMl/B71xM/wjWXRe210=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dereksrose.com/images/comment-toots/mastodon-derek.png"><meta name=twitter:title content="Comment Toots"><meta name=twitter:description content="An attempt to power blog comments with Mastodon"><meta property="og:title" content="Comment Toots"><meta property="og:description" content="An attempt to power blog comments with Mastodon"><meta property="og:type" content="article"><meta property="og:url" content="https://dereksrose.com/posts/comment-toots/"><meta property="og:image" content="https://dereksrose.com/images/comment-toots/mastodon-derek.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-19T20:23:53-08:00"><meta property="article:modified_time" content="2023-11-18T14:20:17-08:00"><meta property="og:site_name" content="Over-Engineering Is Fun"></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=https://dereksrose.com/profile.png alt="profile picture"><h3 title><a href=/>Over-Engineering Is Fun</a></h3><div class=description><p>My various home automation, electronics, coding, and/or 3D printing projects.</p></div></div></div><ul class=social-links><li><a href=https://github.com/Bishma/ rel=me aria-label=Github><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=https://mas.to/@bishma rel=me aria-label=Mastodon><i class="fab fa-mastodon fa-2x" aria-hidden=true></i></a></li><li><a href=https://www.linkedin.com/in/dereksrose/ rel=me aria-label=LinkedIn><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Derek Rose 2023</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts/ title>Posts</a></li><li><a href=/tags/ title>Tags</a></li><li><a href=/about/ title>About</a></li><li class=theme-switch-item><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."><div class=post-content><div class=post-title><h1>Comment Toots</h1><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Feb 19, 2023</span>
<em class="fas fa-stopwatch"></em>
<span class=reading-time>7-minute read</span></div></div><h2 id=hahahugoshortcodes0hbhb>An attempt to power blog comments with Mastodon</h2><img align=left src=/images/comment-toots/mastodon-derek.png width=280 hspace=25><p>Well, I guess I&rsquo;ve landed on
<a href=https://mas.to/@bishma target=_blank>Mastodon</a> since the bird started shitting everywhere. I was resistant since I don&rsquo;t think it can ever be the real-time discovery engine that Twitter was (at its best). But, seeing as I spent an afternoon linking Mastodon threads as a comment system for this
<a href=https://gohugo.io/ target=_blank>Hugo</a> blog, I guess the choice has been made.</p><p>The downside to this setup is that it requires some editing every time I want to have comments on a post. To enabled comments on a post I need to</p><ul><li>Publish the post to my blog</li><li>Wait for it to deploy</li><li>Write a toot about it</li><li>Get the ID of that Toot</li><li>Edit the post adding the TootID to it</li><li>Wait for it to redeploy</li></ul><p>Hopefully I&rsquo;ll find a way to automate some or all of this process with
<a href=https://github.com/features/actions target=_blank>Github Actions</a>. But that&rsquo;s a problem for future Derek. And that guy&rsquo;s a jerk.</p><p>This whole concept isn&rsquo;t my idea, this is just my take on it. I stumbled on this idea by
<a href=https://carlschwan.eu/2020/12/29/adding-comments-to-your-static-blog-with-mastodon/ target=_blank>Carl Schwan</a> while looking for something else entirely. It&rsquo;s pretty straight forward; A bit of extra YAML each post&rsquo;s
<a href=https://gohugo.io/content-management/front-matter/ target=_blank>Front Matter</a> plus a bit of js, css, and html hacked into my
<a href=https://github.com/lxndrblz/anatole target=_blank>theme</a>. I restyled a number of things and made it so that comments automatically lazy-load, rather than requiring the visitor to click a button. For anyone following along, if you see me reference my <code>anatole/</code> directory replace that with the directory of your theme. It should be set up in a similar way, but your milage may vary.</p><h3 id=step-1-editing-the-post-head-file>Step 1: Editing the post head file</h3><p>Mastodon pulls page information from it Open Graph tags. At the time I got it, my theme didn&rsquo;t have Open Graph incorporated (it does now). Of course, I&rsquo;ve done so much hacking at things that I don&rsquo;t dare update for one simple issue like this. Hugo already provides an open graph partial, so I just needed to
<a href=https://github.com/Bishma/blog/commit/7517756515fbe09d236f76e164b9e91ccf8b20a7 target=_blank>add</a> it to the <code>anatole/layouts/partials/head.html</code> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=p>{{</span> <span class=nx>template</span> <span class=s>&#34;_internal/opengraph.html&#34;</span> <span class=p>.</span> <span class=p>}}</span>
</span></span></code></pre></div><p>The same <code>head.html</code> needs to load the CSS for my comments, so I
<a href=https://github.com/Bishma/blog/commit/78b61e93c1eae6f01b32bdc7e92f45c7e3d3fb5d target=_blank>added that</a> in the file while I was in there. More about CSS specifics later, for now what you need to know is that we&rsquo;re going to reference a css file that we&rsquo;ll be creating inside the Anatole theme. We also Minify it and Fingerprint in the process. The file itself was put in the theme as <code>anatole/assets/js/mastodonComments.css</code>. Get the
<a href=https://github.com/Bishma/blog/blob/master/themes/anatole/assets/css/mastodonComments.css target=_blank>latest version of my CSS</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ $mastodonCommentStyle := resources.Get &#34;css/mastodonComments.css&#34; | resources.Minify | resources.Fingerprint }}
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>href</span><span class=o>=</span><span class=s>&#34;{{ $mastodonCommentStyle.Permalink }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>integrity</span><span class=o>=</span><span class=s>&#34;{{ $mastodonCommentStyle.Data.Integrity }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/css&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=step-2-adding-front-matter>Step 2: Adding Front Matter</h3><p>Each Hugo post/page has a small section of YAML (I use YAML, TOML is an option) that defines all the meta data about the post. This is where were going to tell the post how to find the right Toot to use as that post&rsquo;s comment thread. This needs to be added somewhere in the YAML block.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>comments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>&lt;mastodon server I&#39;m signed up on&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>&lt;my username on that server&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id</span><span class=p>:</span><span class=w> 
</span></span></span></code></pre></div><p>The YAML above was also added to my default post template page located in <code>/archetypes/default.md</code> so that it would be available automatically on all my future posts.</p><h3 id=step-3-the-comments-partial>Step 3: The Comments Partial</h3><p>All the interesting bits are on the comments partial. This was placed inside my theme&rsquo;s partials directory <code>anatole/layouts/partials/comments.html</code>. You can find the latest version of my <code>comments.html</code> partial
<a href=https://github.com/Bishma/blog/blob/master/themes/anatole/layouts/partials/comments.html target=_blank>here</a>.</p><h4 id=details-of-commentshtml-partial>Details of comments.html partial</h4><p>Replying isn&rsquo;t straight forward with this solution. People need a Mastodon account (somewhere) and then they need to post a reply <strong>from</strong> it. What Corl did in his solution was to add a dialog that would pop up and explain things to people. I didn&rsquo;t didn&rsquo;t want to have to style that modal so I just made it inline text that displays below the Comments subheader, provided there is a toot idea present in the posts Front Matter. If there is no Toot ID in the post&rsquo;s front matter, this paragraph will be hidden.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=p>{{</span> <span class=k>if</span> <span class=nx>not</span> <span class=p>.</span><span class=nx>id</span>  <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nx>p</span> <span class=nx>style</span><span class=p>=</span><span class=s>&#34;display: hidden;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{{</span> <span class=k>else</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nx>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{{</span> <span class=nx>end</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=nx>You</span> <span class=nx>can</span> <span class=nx>use</span> <span class=nx>your</span> <span class=nx>Mastodon</span> <span class=nx>account</span> <span class=nx>to</span> <span class=nx>reply</span> <span class=nx>to</span> <span class=nx>this</span> <span class=p>&lt;</span><span class=nx>a</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;link&#34;</span> <span class=nx>href</span><span class=p>=</span><span class=s>&#34;https://{{ .host }}/@{{ .username }}/{{ .id }}&#34;</span> <span class=nx>target</span><span class=p>=</span><span class=s>&#34;_blank&#34;</span><span class=p>&gt;</span><span class=nx>post</span><span class=p>&lt;</span><span class=o>/</span><span class=nx>a</span><span class=p>&gt;.</span> <span class=p>&lt;</span><span class=nx>br</span> <span class=o>/</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>Or</span> <span class=p>&lt;</span><span class=nx>a</span> <span class=nx>href</span><span class=p>=</span><span class=s>&#34;#&#34;</span> <span class=nx>id</span><span class=p>=</span><span class=s>&#34;copyButton&#34;</span><span class=p>&gt;</span><span class=nx>copy</span><span class=p>&lt;</span><span class=o>/</span><span class=nx>a</span><span class=p>&gt;</span> <span class=nx>and</span> <span class=nx>paste</span> <span class=nx>the</span> <span class=nx>post</span> <span class=nx>URL</span> <span class=nx>into</span> <span class=nx>the</span> <span class=nx>search</span> <span class=nx>field</span> <span class=nx>of</span> <span class=nx>the</span> <span class=nx>Mastodon</span> <span class=nx>client</span> <span class=nx>of</span> <span class=nx>your</span> <span class=nx>choice</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=o>/</span><span class=nx>p</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>The <code>copyButton</code> href above has an onclick listener further down the page. It will copy my full mastodon link (sourced from the post&rsquo;s Front Matter) to their clipboard. And it gives a thumbs up for 2 seconds to show it worked.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;copyButton&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>navigator</span><span class=p>.</span><span class=nx>clipboard</span><span class=p>.</span><span class=nx>writeText</span><span class=p>(</span><span class=s1>&#39;https://{{ .host }}/@{{ .username }}/{{ .id }}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Save the original
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>$cpLk</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#copyButton&#34;</span><span class=p>);</span>      
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>originalText</span> <span class=o>=</span> <span class=nx>$cpLk</span><span class=p>.</span><span class=nx>text</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>originalText</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Change the text for 2 seconds
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>$cpLk</span><span class=p>.</span><span class=nx>text</span><span class=p>(</span><span class=s2>&#34;👍&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>$cpLk</span><span class=p>.</span><span class=nx>text</span><span class=p>(</span><span class=nx>originalText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>When it came to having Toots loaded onto a post, I wanted to remove the need to click. Caaarl used a UI button to let users trigger comment loading themselves, but I&rsquo;m not a god that believes in free will. So I load the comments by a lazy-load instead, which triggers 100px from the bottom of the page. I pull in the Toot ID from the page&rsquo;s Front Matter, and if it&rsquo;s empty it will say comments are disabled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// If comments havent been loaded yet, load them when the user scrolls to within 100px of the bottom of the page
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>limitBottom</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>documentElement</span><span class=p>.</span><span class=nx>offsetHeight</span> <span class=o>-</span> <span class=nb>window</span><span class=p>.</span><span class=nx>innerHeight</span> <span class=o>-</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>commentsLoaded</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;scroll&#34;</span><span class=p>,</span><span class=kd>function</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3 conditions
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 1. The user has scrolled to within 100px of the bottom of the page
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 2. Comments have not been loaded yet
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 3. The post has a Mastodon ID (from Params.comments)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>documentElement</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>&gt;=</span> <span class=nx>limitBottom</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>commentsLoaded</span> <span class=o>&amp;&amp;</span> <span class=s1>&#39;{{ .id  }}&#39;</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>loadComments</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>commentsLoaded</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=s1>&#39;{{ .id  }}&#39;</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;mastodon-comments-list&#39;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&lt;em&gt;Comments are disabled for this post.&lt;/em&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>Once the comments partial is
<a href=https://github.com/Bishma/blog/blob/master/themes/anatole/layouts/partials/comments.html target=_blank>downloaded</a> to the correct directory in the template, the partial can be called from inside the single page layout (in <code>anatole/layouts/single.html</code>). Just above the footer content I
<a href=https://github.com/Bishma/blog/commit/5f1b177ad9d3b65e084e899ff63b103f81b8b137 target=_blank>added</a> a test to make sure we&rsquo;re in a blog post, inside of which is a call to the partial.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=p>{{</span> <span class=k>if</span> <span class=nx>eq</span> <span class=p>.</span><span class=nx>Type</span> <span class=s>&#34;posts&#34;</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>partial</span> <span class=s>&#34;comments.html&#34;</span> <span class=p>.</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>{{</span> <span class=nx>end</span> <span class=p>}}</span>
</span></span></code></pre></div><p>Now we need to style and js things.</p><h3 id=step-4-css-and-js-the-terror-twins>Step 4: CSS and JS, the terror twins</h3><p>Most of you looking at this blog instinctively know that I&rsquo;m a backend guy. I&rsquo;m a lot happier working with IaaS, than I am working with CSS. But since no one joined by dial-in BBS, here we are.</p><p>First I need a 3rd party JS library called
<a href=https://github.com/cure53/DOMPurify/blob/main/dist/purify.js target=_blank>DOMPurify</a>. It&rsquo;s used to sanitize each reply toot to catch anything injecty or XSSy coming through. I downloaded the latest version and put it in my theme&rsquo;s js directory, <code>anatole/asset/js</code>. It gets called by the comments partial discussed above.</p><p>We also need the CSS that was mentioned above. I already downloaded it and it&rsquo;s called from inside the comments partial discussed above. It is clumsy AF but it gets the job done. It styles the commenters avatar, display name, and username along with their comments. I may not like everyone&rsquo;s avatars being on my site, so this it the place to tweak that display.</p><h3 id=step-5-post-this-and-see-what-happens>Step 5: Post this and see what happens</h3><p>We&rsquo;ll see how long this takes to break or how soon I realize that testing in FF and Chrome in a single OS is not sufficient.</p><p>Really this is just a toy that kept me busy for around a day. But I had fun and I learned more about Hugo in the process.</p><div class=article-content><h2>Comments</h2><p>You can use your Mastodon account to reply to this <a class=link href=https://mas.to/@bishma/109895237625187249 target=_blank>post</a>.<br>Or <a href=# id=copyButton>copy</a> and paste the post URL into the search field of the Mastodon client of your choice.</p><p id=mastodon-comments-list></p><noscript><p>You need JavaScript to view the comments.</p></noscript><script type=text/javascript src=https://dereksrose.com/js/purify.min.b09fc1236623fcc137f6a0e631ab67567ffeea4cf6d17ab50819265b0a91880e.js></script>
<script type=text/javascript>let limitBottom=document.documentElement.offsetHeight-window.innerHeight-100,commentsLoaded=!1;window.addEventListener("scroll",function(){document.documentElement.scrollTop>=limitBottom&&!commentsLoaded&&"109895237625187249"!=""?(loadComments(),commentsLoaded=!0):"109895237625187249"==""&&(document.getElementById("mastodon-comments-list").innerHTML="<em>Comments are disabled for this post.</em>")}),document.getElementById("copyButton").addEventListener("click",e=>{navigator.clipboard.writeText("https://mas.to/@bishma/109895237625187249"),e.preventDefault();const t=$("#copyButton"),n=t.text();console.log(n),t.text("👍"),setTimeout(function(){t.text(n)},2e3)});function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function loadComments(){fetch("https://mas.to/api/v1/statuses/109895237625187249/context").then(function(e){return e.json()}).then(function(e){e.descendants&&Array.isArray(e.descendants)&&e.descendants.length>0?(document.getElementById("mastodon-comments-list").innerHTML="",e.descendants.forEach(function(e){e.account.display_name=escapeHtml(e.account.display_name),e.account.emojis.forEach(t=>{e.account.display_name=e.account.display_name.replace(`:${t.shortcode}:`,`<img src="${escapeHtml(t.static_url)}" alt="Emoji ${t.shortcode}" height="20" width="20" />`)}),mastodonComment=`<div class="mastodon-comment">
                     <div class="avatar">
                       <img src="${escapeHtml(e.account.avatar_static)}" height=60 width=60 alt="">
                     </div>
                     <div class="content">
                       <div class="author">
                         <a href="${e.account.url}" rel="nofollow">
                           <span class="displayName">${e.account.display_name}</span>
                           <span class="accountName">${escapeHtml(e.account.acct)}</span>
                         </a>
                         <a class="date" href="${e.uri}" rel="nofollow">
                           ${e.created_at.substr(0,10)}
                         </a>
                       </div>
                       <div class="mastodon-comment-content">${e.content}</div> 
                     </div>
                   </div>`,document.getElementById("mastodon-comments-list").appendChild(DOMPurify.sanitize(mastodonComment,{RETURN_DOM_FRAGMENT:!0}))})):document.getElementById("mastodon-comments-list").innerHTML="<p>No comments yet.</p>"})}</script></div></div><br><div class=post-footer><div class=more-title>Find More:</div><div class=info><span class=separator><a class=tag href=/tags/meta/>meta</a><a class=tag href=/tags/hugo/>hugo</a><a class=tag href=/tags/mastodon/>mastodon</a><a class=tag href=/tags/development/>development</a></span></div><span class=separator>&nbsp; &nbsp;</span>
<span class=separator><a class=link-reverse href="https://dereksrose.com/posts/repbox-standoffs/?ref=footer">« Repbox Standoffs</a></span>
<span class=separator>&nbsp; | &nbsp;</span>
<span class=separator><a class=link-reverse href="https://dereksrose.com/posts/garage-door-chock/?ref=footer">Garage Door Chock »</a></span></div></div></div></div></div><script type=text/javascript src=https://dereksrose.com/js/jquery.min.decb4e8fdab5cb7b76ec6470b6fb73d30c7ee8e248d7486f49007f3c525b7acb.js integrity="sha256-3stOj9q1y3t27GRwtvtz0wx+6OJI10hvSQB/PFJbess=" crossorigin=anonymous></script>
<script type=text/javascript src=https://dereksrose.com/js/bundle.min.3ebad6bf39b2e7c2f899d3ed9bc97e8c0c1ead7a1b57472e3387321f673b8077.js integrity="sha256-PrrWvzmy58L4mdPtm8l+jAwerXobV0cuM4cyH2c7gHc=" crossorigin=anonymous></script>
<script type=text/javascript src=https://dereksrose.com/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-153109937-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script type=text/javascript src=https://dereksrose.com/js/lightbox.min.76de40f9671361fabb5e45e99a176e1740b7cf06557da3b0ce60372bcc92962b.js integrity="sha256-dt5A+WcTYfq7XkXpmhduF0C3zwZVfaOwzmA3K8ySlis=" crossorigin=anonymous></script></body></html>